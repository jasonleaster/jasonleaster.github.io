
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>EOF</title>
  <meta name="author" content="Jason Leaster">

  
  <meta name="description" content="Preparation Here, we are goint to analysis how Python deal with Int Object in itself. First of all, we should have a environment which help us to &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jasonleaster.github.io/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="EOF" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">EOF</a></h1>
  
    <h2>Rebuilding The Tower Of Babel</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="jasonleaster.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/todo">TODO</a></li>
  <li><a href="/about-me">About Me</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/02/03/memory-model-of-int-object-in-python/">Int Object in Python</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-02-03T00:56:31+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2016</span></span> <span class='time'>12:56 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Preparation</h3>

<p>Here, we are goint to analysis how Python deal with <code>Int Object</code> in itself.</p>

<p>First of all, we should have a environment which help us to explore the detail of the implementation in <code>Python 2.7</code>. At the same time, our operation shouldn&rsquo;t influence the origianl Python in your workstation, if you have install Python before.</p>

<p>You can get the source code from offical website of Python. And you will find that there have a file <code>configure</code> in the directory of the source.</p>

<p><em>In the file configure, you can replace all string &lsquo;Python&rsquo; with &lsquo;pyLab&rsquo;. And then move all file prefix with <code>Python</code> into <code>pyLab</code>(mainly in directory Misc/ and Modules)</em></p>

<p>Don&rsquo;t forget to run the configuration file &ndash; configure with the option <code>--prefix=Location where you want the Python which is for lab to install</code></p>

<p>Finally, just run <code>make &amp; make install</code></p>

<p>Repeat myself again, the reason that I move all &lsquo;Python&rsquo; into &lsquo;pyLab&rsquo; is all for making a difference with the original instance which is official and shouldn&rsquo;t be influence by any operation from us.</p>

<h3>Rules of Object in Python.</h3>

<ul>
<li>Objects are structures allocated on the heap.</li>
<li><p>Objects are never allocated statically or on the stack; they must be accessed through special macros and functions only.</p></li>
<li><p>An object has a &lsquo;reference count&rsquo; that is increased or decreased when a pointer to the object is copied or deleted; when the reference count reaches zero there are no references to the object left and it can be removed from the heap.</p></li>
<li><p>An object has a &lsquo;type&rsquo; that determines what it represents and what kind of data it contains.  An object&rsquo;s type is fixed when it is created. Types themselves are represented as objects; an object contains a pointer to the corresponding type object.  The type itself has a type pointer pointing to the object representing the type &lsquo;type&rsquo;, which contains a pointer to itself!).</p></li>
<li><p>Objects do not float around in memory; once allocated an object keeps the same size and address.  Objects that must hold variable-size data can contain pointers to variable-size parts of the object.  Not all objects of the same type have the same size; but the size cannot change after allocation.</p></li>
<li><p>Objects are always accessed through pointers of the type &lsquo;PyObject *&rsquo;.</p></li>
</ul>


<h3>Firt glance at the implementation.</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>/*
</span><span class='line'>   There are two basic different type of Object in Python.
</span><span class='line'>   1. PyObject.    (Immutable Object eg: int, string object which's 
</span><span class='line'>                                size is known when it is creating.)
</span><span class='line'>   2. PyVarObject. (Mutable Object eg: list object which's size is 
</span><span class='line'>                    unknown when it is creating and support the 
</span><span class='line'>                    operation of deleting and inserting)
</span><span class='line'>                        -- notes by Jason Leaster
</span><span class='line'> */
</span><span class='line'>typedef struct _object {
</span><span class='line'>    PyObject_HEAD
</span><span class='line'>} PyObject;
</span><span class='line'>
</span><span class='line'>typedef struct {
</span><span class='line'>    PyObject_VAR_HEAD
</span><span class='line'>} PyVarObject;</span></code></pre></td></tr></table></div></figure>


<p>Actually, PyObject are created by Macro <code>PyObject_HEAD</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Include/object.h]
</span><span class='line'>
</span><span class='line'>...
</span><span class='line'>
</span><span class='line'>#define _PyObject_HEAD_EXTRA            \
</span><span class='line'>    struct _object *_ob_next;           \
</span><span class='line'>    struct _object *_ob_prev;
</span><span class='line'>
</span><span class='line'>#define _PyObject_EXTRA_INIT 0, 0,
</span><span class='line'>
</span><span class='line'>#define PyObject_HEAD                   \
</span><span class='line'>    _PyObject_HEAD_EXTRA                \
</span><span class='line'>    Py_ssize_t ob_refcnt;               \
</span><span class='line'>    struct _typeobject *ob_type;
</span><span class='line'>
</span><span class='line'>/* 
</span><span class='line'>   There also have some Macro to get the data member of PyObject.
</span><span class='line'>                    -- notes by Jason Leaster
</span><span class='line'> */
</span><span class='line'>#define Py_REFCNT(ob)           (((PyObject*)(ob))-&gt;ob_refcnt)
</span><span class='line'>#define Py_TYPE(ob)             (((PyObject*)(ob))-&gt;ob_type)
</span><span class='line'>#define Py_SIZE(ob)             (((PyVarObject*)(ob))-&gt;ob_size)
</span><span class='line'>
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>


<p>Typically, the Int Object in Python <code>PyIntObject</code> is a <code>immutable object</code>. Once we created the object, we can&rsquo;t change the value in that object.</p>

<p>Back to our topic, let&rsquo;s look at the definition of <code>PyIntObject</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//[Include/intobject.h]
</span><span class='line'>
</span><span class='line'>typedef struct{
</span><span class='line'>    PyObject_HEAD
</span><span class='line'>    long ob_ival;
</span><span class='line'>} PyIntObject;</span></code></pre></td></tr></table></div></figure>


<p>Aha, the <code>PyIntObject</code> is just a simple capsulation of <code>long</code> in C.
This object maintain a long data member.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>static int
</span><span class='line'>int_compare(PyIntObject *v, PyIntObject *w)
</span><span class='line'>{
</span><span class='line'>    /*
</span><span class='line'>    You will sigh that "the author of Python is a master in 
</span><span class='line'>    programming". For efficient, they use `register` keyword and 
</span><span class='line'>    try to apply for using register to store the local variable.
</span><span class='line'>                            -- notes by Jason Leaster.
</span><span class='line'>    */
</span><span class='line'>    register long i = v-&gt;ob_ival;
</span><span class='line'>    register long j = w-&gt;ob_ival;
</span><span class='line'>    return (i &lt; j) ? -1 : (i &gt; j) ? 1 : 0;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>How about the detail of printing a integer in Python ?</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/* ARGSUSED */
</span><span class='line'>static int
</span><span class='line'>int_print(PyIntObject *v, FILE *fp, int flags)
</span><span class='line'>    /* flags -- not used but required by interface */
</span><span class='line'>{
</span><span class='line'>    long int_val = v-&gt;ob_ival;
</span><span class='line'>    Py_BEGIN_ALLOW_THREADS
</span><span class='line'>    fprintf(fp, "%ld", int_val);
</span><span class='line'>    Py_END_ALLOW_THREADS
</span><span class='line'>    return 0;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>There have many others method which are defined in <code>PyNumberMethods</code>. Python programmer can get the information about the object with a data member <code>__doc__</code>, like this:</p>

<p><img src="/images/img_for_2016_02_03/doc.png" alt="images" /></p>

<p>The implementation of that is just a plain text string in <code>Object/intobject.c</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>PyDoc_STRVAR(int_doc,
</span><span class='line'>"int(x=0) -&gt; int or long\n\
</span><span class='line'>int(x, base=10) -&gt; int or long\n\
</span><span class='line'>\n\
</span><span class='line'>Convert a number or string to an integer, or return 0 if no arguments\n\
</span><span class='line'>are given.  If x is floating point, the conversion truncates towards zero.\n\
</span><span class='line'>If x is outside the integer range, the function returns a long instead.\n\
</span><span class='line'>\n\
</span><span class='line'>If x is not a number or if base is given, then x must be a string or\n\
</span><span class='line'>Unicode object representing an integer literal in the given base.  The\n\
</span><span class='line'>literal can be preceded by '+' or '-' and be surrounded by whitespace.\n\
</span><span class='line'>The base defaults to 10.  Valid bases are 0 and 2-36.  Base 0 means to\n\
</span><span class='line'>interpret the base from the string as an integer literal.\n\
</span><span class='line'>&gt;&gt;&gt; int('0b100', base=0)\n\
</span><span class='line'>4");
</span></code></pre></td></tr></table></div></figure>


<h3>Initialization of PyIntObject</h3>

<p>Python support many different API to construct a <code>PyIntObject</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="no">Include</span><span class="o">/</span><span class="n">intobject</span><span class="o">.</span><span class="n">h</span><span class="o">]</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="no">PyAPI_FUNC</span><span class="p">(</span><span class="no">PyObject</span> <span class="o">*</span><span class="p">)</span> <span class="no">PyInt_FromString</span><span class="p">(</span><span class="n">char</span><span class="o">*</span><span class="p">,</span> <span class="n">char</span><span class="o">**</span><span class="p">,</span> <span class="n">int</span><span class="p">);</span>
</span><span class='line'><span class="c1">#ifdef Py_USING_UNICODE</span>
</span><span class='line'><span class="no">PyAPI_FUNC</span><span class="p">(</span><span class="no">PyObject</span> <span class="o">*</span><span class="p">)</span> <span class="no">PyInt_FromUnicode</span><span class="p">(</span><span class="no">Py_UNICODE</span><span class="o">*</span><span class="p">,</span> <span class="no">Py_ssize_t</span><span class="p">,</span> <span class="n">int</span><span class="p">);</span>
</span><span class='line'><span class="c1">#endif</span>
</span><span class='line'><span class="no">PyAPI_FUNC</span><span class="p">(</span><span class="no">PyObject</span> <span class="o">*</span><span class="p">)</span> <span class="no">PyInt_FromLong</span><span class="p">(</span><span class="n">long</span><span class="p">);</span>
</span><span class='line'><span class="no">PyAPI_FUNC</span><span class="p">(</span><span class="no">PyObject</span> <span class="o">*</span><span class="p">)</span> <span class="no">PyInt_FromSize_t</span><span class="p">(</span><span class="n">size_t</span><span class="p">);</span>
</span><span class='line'><span class="no">PyAPI_FUNC</span><span class="p">(</span><span class="no">PyObject</span> <span class="o">*</span><span class="p">)</span> <span class="no">PyInt_FromSsize_t</span><span class="p">(</span><span class="no">Py_ssize_t</span><span class="p">);</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>Before we dig into the implementation of the initialization process.
Let&rsquo;s do a lab.</p>

<p><img src="/images/img_for_2016_02_03/different_address.png" alt="images" /></p>

<p><code>id(object)</code> will returen the address of object in CPython.</p>

<p>Try to answer the following question.</p>

<p>Why int object <code>m</code> and <code>n</code> of value <code>1000</code> have different address?</p>

<p>Why int object <code>x</code> and <code>y</code> of value <code>1</code>    have the same  address?</p>

<p>The answer relate to the mechanism with numbers in Python.</p>

<p><em>In daily programming stuff, small number are used frequently. But large number may used frequent more than small numbers</em></p>

<p>If there isn&rsquo;t a special mechanism, Python will allocate memory(call malloc() in C) again and again. This stratege isn&rsquo;t efficient at run time.
So, Python support a mechanism which will create small number only once but not bigger number.</p>

<p>There also have the other question. What means big? What means small?
It&rsquo;s not clearly in theory. But in the implementation, there have a trade off. People can&rsquo;t cache all integer number for the limitation of memory(RAM).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='C++'><span class='line'><span class="p">[</span><span class="n">Object</span><span class="o">/</span><span class="n">intobject</span><span class="p">]</span>
</span><span class='line'><span class="p">...</span>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">NSMALLPOSINTS:    Numbers of small positive integers number</span>
</span><span class='line'><span class="cm">NSMALLNEGINTS:    Numbers of small negative integers number</span>
</span><span class='line'><span class="cm">        --notes by Jason Leaster</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="cp">#ifndef NSMALLPOSINTS  </span>
</span><span class='line'><span class="cp">#define NSMALLPOSINTS           257</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'><span class="cp">#ifndef NSMALLNEGINTS  </span>
</span><span class='line'><span class="cp">#define NSMALLNEGINTS           5</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'><span class="cp">#if NSMALLNEGINTS + NSMALLPOSINTS &gt; 0</span>
</span><span class='line'><span class="cm">/*  References to small integers are saved in this array so that they</span>
</span><span class='line'><span class="cm">    can be shared.</span>
</span><span class='line'><span class="cm">    The integers that are saved are those in the range</span>
</span><span class='line'><span class="cm">    -NSMALLNEGINTS (inclusive) to NSMALLPOSINTS (not inclusive).</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="k">static</span> <span class="n">PyIntObject</span> <span class="o">*</span><span class="n">small_ints</span><span class="p">[</span><span class="n">NSMALLNEGINTS</span> <span class="o">+</span> <span class="n">NSMALLPOSINTS</span><span class="p">];</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'><span class="p">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>According to the implementation, the small number is [-5, 257). You can also modify the source code and recomplie it to change the range of small number, if you would like to.</p>

<blockquote><p>  Integers are quite normal objects, to make object handling uniform.
   (Using odd pointers to represent integers would save much space
   but require extra checks for this special case throughout the code.)
   Since a typical Python program spends much of its time allocating
   and deallocating integers, these operations should be very fast.
   Therefore we use a dedicated allocation scheme with a much lower
   overhead (in space and time) than straight malloc(): a simple
   dedicated free list, filled when necessary with memory from malloc().
   block_list is a singly-linked list of all PyIntBlocks ever allocated,  linked via their next members.  PyIntBlocks are never returned to the
   system before shutdown (PyInt_Fini).
   free_list is a singly-linked list of available PyIntObjects, linked
   via abuse of their ob_type members.</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='C++'><span class='line'><span class="cp">#define BLOCK_SIZE      1000    </span><span class="cm">/* 1K less typical malloc overhead */</span><span class="cp"></span>
</span><span class='line'><span class="cp">#define BHEAD_SIZE      8       </span><span class="cm">/* Enough for a 64-bit pointer */</span><span class="cp"></span>
</span><span class='line'><span class="cp">#define N_INTOBJECTS    ((BLOCK_SIZE - BHEAD_SIZE) / sizeof(PyIntObject))</span>
</span><span class='line'>
</span><span class='line'><span class="k">struct</span> <span class="n">_intblock</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">struct</span> <span class="n">_intblock</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
</span><span class='line'>    <span class="n">PyIntObject</span> <span class="n">objects</span><span class="p">[</span><span class="n">N_INTOBJECTS</span><span class="p">];</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="k">typedef</span> <span class="k">struct</span> <span class="n">_intblock</span> <span class="n">PyIntBlock</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="n">PyIntBlock</span> <span class="o">*</span><span class="n">block_list</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'><span class="k">static</span> <span class="n">PyIntObject</span> <span class="o">*</span><span class="n">free_list</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="c1">// Initliazed by fill_free_list()</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Insert and Delete</h3>

<p>A initialization routine from <code>long type</code> integer number.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">PyObject</span> <span class="o">*</span>
</span><span class='line'><span class="no">PyInt_FromLong</span><span class="p">(</span><span class="n">long</span> <span class="n">ival</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">register</span> <span class="no">PyIntObject</span> <span class="o">*</span><span class="n">v</span><span class="p">;</span>
</span><span class='line'>    <span class="sr">//</span> <span class="n">try</span> <span class="n">to</span> <span class="n">use</span> <span class="n">small</span> <span class="n">number</span> <span class="n">pool</span>
</span><span class='line'><span class="c1">#if NSMALLNEGINTS + NSMALLPOSINTS &gt; 0</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">-</span><span class="no">NSMALLNEGINTS</span> <span class="o">&lt;=</span> <span class="n">ival</span> <span class="o">&amp;&amp;</span> <span class="n">ival</span> <span class="o">&lt;</span> <span class="no">NSMALLPOSINTS</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">v</span> <span class="o">=</span> <span class="n">small_ints</span><span class="o">[</span><span class="n">ival</span> <span class="o">+</span> <span class="no">NSMALLNEGINTS</span><span class="o">]</span><span class="p">;</span>
</span><span class='line'>        <span class="no">Py_INCREF</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
</span><span class='line'><span class="c1">#ifdef COUNT_ALLOCS</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">ival</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>            <span class="n">quick_int_allocs</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>        <span class="k">else</span>
</span><span class='line'>            <span class="n">quick_neg_int_allocs</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'><span class="c1">#endif</span>
</span><span class='line'>        <span class="k">return</span> <span class="p">(</span><span class="no">PyObject</span> <span class="o">*</span><span class="p">)</span> <span class="n">v</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="c1">#endif</span>
</span><span class='line'>
</span><span class='line'>   <span class="sr">//</span> <span class="k">if</span> <span class="n">ival</span> <span class="n">is</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">small</span> <span class="n">number</span><span class="p">,</span> <span class="n">create</span> <span class="n">a</span> <span class="kp">new</span> <span class="n">instance</span> <span class="n">object</span><span class="o">.</span>
</span><span class='line'>   <span class="k">if</span> <span class="p">(</span><span class="n">free_list</span> <span class="o">==</span> <span class="no">NULL</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>       <span class="k">if</span> <span class="p">((</span><span class="n">free_list</span> <span class="o">=</span> <span class="n">fill_free_list</span><span class="p">())</span> <span class="o">==</span> <span class="no">NULL</span><span class="p">)</span>
</span><span class='line'>           <span class="sr">/*</span>
</span><span class='line'><span class="sr">              fill_free_list() will create a general number pool </span>
</span><span class='line'><span class="sr">              for PyIntObjects.</span>
</span><span class='line'><span class="sr">              But if there is no memory, return NULL</span>
</span><span class='line'><span class="sr">            */</span>
</span><span class='line'>           <span class="k">return</span> <span class="no">NULL</span><span class="p">;</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'>   <span class="sr">/* Inline PyObject_New */</span>
</span><span class='line'>   <span class="n">v</span> <span class="o">=</span> <span class="n">free_list</span><span class="p">;</span>
</span><span class='line'>   <span class="n">free_list</span> <span class="o">=</span> <span class="p">(</span><span class="no">PyIntObject</span> <span class="o">*</span><span class="p">)</span><span class="no">Py_TYPE</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
</span><span class='line'>   <span class="sr">//</span> <span class="no">Py_TYPE</span><span class="p">(</span><span class="n">ob</span><span class="p">)</span>  <span class="p">(((</span><span class="no">PyObject</span><span class="o">*</span><span class="p">)(</span><span class="n">ob</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">ob_type</span><span class="p">)</span> <span class="o">--</span><span class="n">notes</span> <span class="n">by</span> <span class="no">Jason</span> <span class="no">Leaster</span>
</span><span class='line'>   <span class="no">PyObject_INIT</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="o">&amp;</span><span class="no">PyInt_Type</span><span class="p">);</span>
</span><span class='line'>   <span class="n">v</span><span class="o">-&gt;</span><span class="n">ob_ival</span> <span class="o">=</span> <span class="n">ival</span><span class="p">;</span>
</span><span class='line'>   <span class="k">return</span> <span class="p">(</span><span class="no">PyObject</span> <span class="o">*</span><span class="p">)</span> <span class="n">v</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Time for Hacking</h3>

<p>Modify the <code>int_print</code> function in <code>Object/intobject.c</code>.
Here is my modification:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
</pre></td><td class='code'><pre><code class='C++'><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> Programmer : Jason Leaster</span>
</span><span class='line'><span class="cm"> Date       : 2016.02.03</span>
</span><span class='line'>
</span><span class='line'><span class="cm"> Modify from Robert Chen&#39;s code.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="n">tatic</span> <span class="kt">int</span> <span class="n">values</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
</span><span class='line'><span class="k">static</span> <span class="kt">int</span> <span class="n">refcounts</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="kt">int</span>
</span><span class='line'><span class="nf">int_print</span><span class="p">(</span><span class="n">PyIntObject</span> <span class="o">*</span><span class="n">v</span><span class="p">,</span> <span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">)</span>
</span><span class='line'>         <span class="cm">/* flags -- not used but required by interface */</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>        <span class="c1">// &lt;&lt;&lt; modified by Jason Leaster</span>
</span><span class='line'>        <span class="n">PyIntObject</span><span class="o">*</span> <span class="n">intObjectPtr</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>        <span class="n">PyIntBlock</span><span class="o">*</span> <span class="n">p</span>    <span class="o">=</span> <span class="n">block_list</span><span class="p">;</span>
</span><span class='line'>        <span class="n">PyIntBlock</span><span class="o">*</span> <span class="n">last</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="k">while</span><span class="p">(</span><span class="n">p</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">count</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>            <span class="n">last</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>
</span><span class='line'>            <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">intObjectPtr</span> <span class="o">=</span> <span class="n">last</span><span class="o">-&gt;</span><span class="n">objects</span><span class="p">;</span>
</span><span class='line'>        <span class="n">intObjectPtr</span><span class="o">+=</span> <span class="n">N_INTOBJECTS</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot; Address @%p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="o">--</span><span class="n">intObjectPtr</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">intObjectPtr</span><span class="o">-&gt;</span><span class="n">ob_ival</span><span class="p">;</span>
</span><span class='line'>            <span class="n">refcounts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">intObjectPtr</span><span class="o">-&gt;</span><span class="n">ob_refcnt</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot; Values: &quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot; refcnt: &quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">refcounts</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot; block_list count: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot; free_list : %p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">free_list</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// &gt;&gt;&gt; Origianl</span>
</span><span class='line'>        <span class="kt">long</span> <span class="n">int_val</span> <span class="o">=</span> <span class="n">v</span><span class="o">-&gt;</span><span class="n">ob_ival</span><span class="p">;</span>
</span><span class='line'>        <span class="n">Py_BEGIN_ALLOW_THREADS</span>
</span><span class='line'>        <span class="n">fprintf</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s">&quot;%ld&quot;</span><span class="p">,</span> <span class="n">int_val</span><span class="p">);</span>
</span><span class='line'>        <span class="n">Py_END_ALLOW_THREADS</span>
</span><span class='line'>        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="/images/img_for_2016_02_03/printout.png" alt="images" /></p>

<hr />

<p>Photo by Jason Leaster
<img src="/images/img_for_2016_02_03/street.jpg" alt="images" /></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/12/30/machine-learning-with-k-means/">Machine Learning With K-Means</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-12-30T16:03:13+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>30</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>4:03 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>K-Means is a classical unsupervised clustering Learning Algorithm. The detail of the theory about K-Means that you can find it in Wikipedia. Now I introduce to implement this algorithm by myself.</p>

<p>If you are interesting in the implementation and change it into a better version, you could find it in my github repository and give me some advices. I will be appreciated.</p>

<hr />

<p>So consider about if I want to classify the data into three different cluster. How could I make it?</p>

<p><img src="/images/img_for_2015_12_30/original.png" alt="images" /></p>

<p>Here is the result:</p>

<p><img src="/images/img_for_2015_12_30/result.png" alt="images" /></p>

<p>With the mean values:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">Means</span> <span class="o">=</span>
</span><span class='line'><span class="p">[[</span><span class="mf">3.5</span>       <span class="mi">1</span>       <span class="mi">6</span><span class="p">]</span>
</span><span class='line'> <span class="p">[</span><span class="mf">1.66666</span>   <span class="mi">6</span>       <span class="mi">6</span><span class="p">]]</span>
</span></code></pre></td></tr></table></div></figure>


</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2015/12/30/machine-learning-with-k-means/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/12/25/labs-of-mit-6-dot-034/">Labs of MIT 6.034</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-12-25T23:30:06+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>11:30 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Two month ago, I decide to do a project about machine learning. So, I get start to learn machine learning and implemment some algorithms of ML.
I find that there is a course in MIT &ndash; 6.034 Artificial Intelligence which contain a lot of funny labs. That will help me to learn ML.</p>

<p>I don&rsquo;t want to write a lot of analysis article about this course like what I have done in 6.008 . So, I just push my solution which also is incompletement onto github. If anyone interesting in this lab, you could touch me and I would like to communicate with you about these labs if I&rsquo;m not busy.</p>

<p>What you should know is that the version of this labs is updated in 2015.</p>

<p>Here is the link you could get my solution:
<a href="https://github.com/jasonleaster/MIT_6.034_2015">My Solution of MIT 6.034</a></p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2015/12/25/labs-of-mit-6-dot-034/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/12/13/machine-learning-with-boosting/">Machine Learning With Boosting</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-12-13T17:00:47+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>5:00 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This blog will talk about the theory and implementation about famouse
concept in machine learning &ndash; <code>Boosting</code>.</p>

<p>All algorithms are implemented in Python.</p>

<p>There are two main tasks which people want to finish with Machine Learning.</p>

<ul>
<li>Classification</li>
<li>Regression</li>
</ul>


<p>There are a lot of other ways to do it but now we focus on <code>boosting</code> algorithm. You know that it&rsquo;s a fantastic way to make our work done.</p>

<h3>Adaboost for classification</h3>

<p>If you never hear about adaboost, I recommend you to finish the 7-th lab in MIT 6.034. It will help you a lot to understand what I&rsquo;m taking about. But this lab didn&rsquo;t build adaboost completely. So, I implement it individually.</p>

<p>Give the input training samples which have tag with it.</p>

<p><img src="/images/img_for_2015_12_13/equation.png" alt="images" /></p>

<p>where x[i] is the feature of the i-th sample point and y[i] is the <code>label</code> (soemtimes we call it as <code>tag</code>) with the sample point.</p>

<p>In this algorithm, there are only two different label of samples {-1, +1}.</p>

<p>Some classifier like decision tree also can work correctly about classification. But it&rsquo;s also easy to overfitting. So, we can&rsquo;t use it in some special situation. Instread of using decision tree, we use <code>decision stump</code> which is a special type of decision tree which&rsquo;s depth is only one. So we call it as <code>decision stump</code>.</p>

<p><code>Yoav Freund</code> and <code>Robert Schapire</code> create this algorithm <strong>AdaBoost</strong> which means adaptive boosting. It combine some weaker classifier into a stronger classifier to avoid overfitting.</p>

<p>Test case:</p>

<p>There are training points with two different label. What if we input a point which&rsquo;s type is unkown, what the result will be?</p>

<p><img src="/images/img_for_2015_12_13/samples.png" alt="images" /></p>

<p>The test result is below there:</p>

<p><img src="/images/img_for_2015_12_13/result.png" alt="images" /></p>

<p>Just create a object of class <code>Adaboost</code> with your training samples with label. like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='Python'><span class='line'><span class="kn">import</span> <span class="nn">adaboost</span>
</span><span class='line'><span class="n">a</span> <span class="o">=</span> <span class="n">AdaBoost</span><span class="p">(</span><span class="n">Original_Data</span><span class="p">,</span> <span class="n">Tag</span><span class="p">)</span>
</span><span class='line'><span class="c"># The up bound of training time to avoid the algorithm won&#39;t stop for not meeting the training accuracy.</span>
</span><span class='line'><span class="n">times</span> <span class="o">=</span> <span class="mi">5</span>
</span><span class='line'>
</span><span class='line'><span class="n">a</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">a</span><span class="o">.</span><span class="n">prediction</span><span class="p">(</span><span class="n">UnkownPoints</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>API <code>prediction()</code> of class AdaBoost will return the result of prediction according to the model. All job done.</p>

<p>You could find other test case in my repository in github.</p>

<p><a href="https://github.com/jasonleaster/Machine_Learning/tree/master/Adaboost">Implementation of Adaboost in Python</a></p>

<p>You can check the validity of my implementation by the accuracy.</p>

<p><img src="/images/img_for_2015_12_13/samples2.png" alt="images" /></p>

<p>The data used to train the weaker classifier and get that accuracy is showed below there :</p>

<p><img src="/images/img_for_2015_12_13/accuracy.png" alt="images" /></p>

<h3>Boosting Tree</h3>

<p>We have knew to use <code>AdaBoost</code> to do classification. <code>Boosting Tree</code> will help us to do regression.</p>

<p>We also use decision stump as the weak classifier. But implementation of decision stump in this algorithm is not the same as that in AdaBoost.</p>

<p>There are ten samples in my test module:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">Original_Data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
</span><span class='line'>        <span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span class='line'>        <span class="p">[</span><span class="mi">3</span><span class="p">],</span>
</span><span class='line'>        <span class="p">[</span><span class="mi">4</span><span class="p">],</span>
</span><span class='line'>        <span class="p">[</span><span class="mi">5</span><span class="p">],</span>
</span><span class='line'>        <span class="p">[</span><span class="mi">6</span><span class="p">],</span>
</span><span class='line'>        <span class="p">[</span><span class="mi">7</span><span class="p">],</span>
</span><span class='line'>        <span class="p">[</span><span class="mi">8</span><span class="p">],</span>
</span><span class='line'>        <span class="p">[</span><span class="mi">9</span><span class="p">],</span>
</span><span class='line'>        <span class="p">[</span><span class="mi">10</span><span class="p">],</span>
</span><span class='line'>        <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span class='line'>        <span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="n">ExpVal</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
</span><span class='line'>        <span class="p">[</span><span class="mf">5.70</span><span class="p">],</span>
</span><span class='line'>        <span class="p">[</span><span class="mf">5.91</span><span class="p">],</span>
</span><span class='line'>        <span class="p">[</span><span class="mf">6.40</span><span class="p">],</span>
</span><span class='line'>        <span class="p">[</span><span class="mf">6.80</span><span class="p">],</span>
</span><span class='line'>        <span class="p">[</span><span class="mf">7.05</span><span class="p">],</span>
</span><span class='line'>        <span class="p">[</span><span class="mf">8.90</span><span class="p">],</span>
</span><span class='line'>        <span class="p">[</span><span class="mf">8.70</span><span class="p">],</span>
</span><span class='line'>        <span class="p">[</span><span class="mf">9.00</span><span class="p">],</span>
</span><span class='line'>        <span class="p">[</span><span class="mf">9.05</span><span class="p">],</span>
</span><span class='line'>        <span class="p">[</span><span class="mf">5.56</span><span class="p">]</span>
</span><span class='line'>        <span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>The expected value of Original_Data[i] is ExpVal[i]. The input is from 1 to 10. How about to predict the output when the input is 1 or 11?</p>

<p>Let&rsquo;s test it. Here is the result:
<img src="/images/img_for_2015_12_13/output_of_boosting_tree.png" alt="images" /></p>

<p>Just used 11 weak classifier to construct a stronger classifier to do the regressio. The output is reasonable.</p>

<p>Here is my implementation of <code>Boosting Tree</code>
<a href="https://github.com/jasonleaster/Machine_Learning/tree/master/Boosting_Tree">Implementation of Boosting Tree in Python</a></p>

<p>Reference:</p>

<ol>
<li>MIT-6.034, Artificial Intelligence. Lab-7</li>
<li>&lt;&lt; The statistic methods >> by HangLi.</li>
<li><a href="https://en.wikipedia.org/wiki/AdaBoost">Wikipedia</a></li>
</ol>


<hr />

<p>Photo by Jason Leaster</p>

<p><img src="/images/img_for_2015_12_13/street.png" alt="images" /></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/09/24/binary-search-tree/">Binary Search Tree</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-09-24T01:28:33+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>1:28 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I try to collect problems about <code>Binary Search Tree (BST)</code> which are asked in interview frequently.</p>

<p>Basicly, here is the definition of Binary Search Tree. And I show the way how to implement the basic operation like <code>insert</code>, <code>delete</code> and so on.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">TreeNode</span><span class="p">()</span> <span class="p">:</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
</span><span class='line'>      <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">num</span>
</span><span class='line'>      <span class="bp">self</span><span class="o">.</span><span class="n">right</span>  <span class="o">=</span> <span class="bp">None</span>
</span><span class='line'>      <span class="bp">self</span><span class="o">.</span><span class="n">left</span>   <span class="o">=</span> <span class="bp">None</span>
</span></code></pre></td></tr></table></div></figure>


<p>You could find all my practices with BST in github: <a href="https://github.com/jasonleaster/Algorithm/blob/master/Binary_Search_Tree/Python_version/bst.py">BST</a></p>

<p><img src="/images/img_for_2015_09_25/bst.png" alt="images" /></p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2015/09/24/binary-search-tree/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/24/binary-search/">Binary Search</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-07-24T10:17:20+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:17 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This is a story why I write this algorithm again.</p>

<blockquote><p>In this days, I work as an intern for Alibaba. To be honest, it totally a bad time for the beginning days. More awful fact to me is that my mentor do his job mostly in Java and I have to pick it up as quickly as possible. It’s totally a stranger for me about Java. <strong>What I have to say is that thanks god and my mentor.</strong> He is so nice and never blame me for my problem. You know that I suffer pressure heavily for I learned nothing but time wasted in this two weeks. I asked for help from human resource manager and hope to find someone guide me to walk out this shadow. Bo who is my mentor. He understand me and know my feeling. Bo encourage me and try to let me believe things will be better. Today, I face to a problem which I think is very naive but I didn’t show the solution to a leader of a department very well. And I could feel that he doubt about my ability in programming. I feel shame about he ask me that “Do you have programming in C or C++ for ten thousand lines ?”.</p></blockquote>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2015/07/24/binary-search/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/17/what-should-we-focus-on/">What Should We Focus on ?</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-17T02:46:15+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>2:46 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Nowadays, people use the social networks like <code>Facebook</code>, <code>Weibo</code>, <code>Qzone</code> and so on. That social networks make you feel that you live with others who have no relationship with you in real life. And more and more people pay a lot of time to refresh the website or the software which is programed for social networks. So did I …</p>

<p>The most important fact is that the message comes from the social networks didn’t help us a lot. If you pay the same time to read a classical book or work hard on your projects, you will get more.</p>

<p>But you choose to refresh your social networks and fall into it. You may know that you are wasting time but you still focus on it. Something like drug … yes, you are drugging but in a different way. Social networks also let you indulge yourself with idle and feel hollow after you have waste a lot of time on that. Day after day, you get nothing but only feel more and more hollow. You know that people live well from the message which the social networks feed you.</p>

<p>Times always change, there will be more and more temptation. But the thing we should know is that we should learn to distinguish what’s important and what just kill us by wating our time.</p>

<p>I delete all message I posted on <code>Weibo</code> and <code>Qzone</code>. In previous days, I followed more than two hundred people in <code>Weibo</code>. To be honest, people I followed most don’t know me and have nothing with my own life. Why I follow them just because I curious about what happened on their daily life. In the beginning, it’s funny. But now I delete them all. Yep, I wake up to reality! It have onthing with my life! I shouldn’t waste time on others who isn’t important for me. WE DO HAVE OUROWN LIFE.</p>

<p>I like a motto from steve jobs.</p>

<blockquote><p>If you want to live your life in a creative way, as an artist, you have to not look back too much. You have to be willing to take whatever you’ve done and whoever you were and throw them away. People think focus means saying yes to the thing you’ve got to focus on. But that’s not what it means at all. It means saying not to the hundred other good ideas that there be. You have to pick carefully. I’m actually as proud of the things we haven’t done as the things I have done. Innovation is saying no to 1,000 things.</p></blockquote>

<p>What I want to say is that</p>

<blockquote><p>“Focus on yourself :)”.</p></blockquote>

<hr />

<p>Photo by Jason Leaster</p>

<p><img src="/images/img_for_2015_06_17/street.png" alt="images" /></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/13/memory-model-of-objects-in-c-plus-plus/">Memory Model of Objects in C++</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-13T19:48:42+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>7:48 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In this blog, I assume that you have a basic background about C++ and know that there is a “monster” we call it as <code>virtual table</code> :)</p>

<p>If there is virtual member function in your class’s definition, there will be a virtual table.</p>

<p>Compiler will generate a pointer which’s name is <code>_vprt</code> and use this pointer to find the virtual table.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2015/06/13/memory-model-of-objects-in-c-plus-plus/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/25/learn-to-design-a-container/">Learn to Design a Container</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-25T19:14:38+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>7:14 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Container is a collection which help us to store data of different types of data structure.</p>

<p>There are only two types of container in C++/C :</p>

<ul>
<li>array</li>
<li>structure</li>
</ul>


<p>C++ could provide more container but it didn’t.</p>

<p><strong>Give a man a fish and you feed him for a day; teach a man to fish and you feed him for a lifetime; knowledge is the best charity;</strong></p>

<p>:)</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2015/05/25/learn-to-design-a-container/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/24/an-exercise-of-c-plus-plus/">An Exercise of C++</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-24T13:57:36+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>1:57 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In &lt;&lt; The C++ Programming Language >> , there is a exercise for learner who is studying C++. It’s that student should write a program in C++ to manipulate “character picture”, something like this.</p>

<p><img src="/images/img_for_2015_05_24/output.png" alt="images" /></p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2015/05/24/an-exercise-of-c-plus-plus/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar"> 
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="http://music.163.com/outchain/player?type=2&id=30706129&auto=1&height=66"></iframe>

  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/02/03/memory-model-of-int-object-in-python/">Int Object in Python</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/12/30/machine-learning-with-k-means/">Machine Learning With K-Means</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/12/25/labs-of-mit-6-dot-034/">Labs of MIT 6.034</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/12/13/machine-learning-with-boosting/">Machine Learning With Boosting</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/24/binary-search-tree/">Binary Search Tree</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Jason Leaster -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











</body>
</html>
